version: 2

models:
  - name: pncview_actual_enrollments
    columns:
      - name: delivery_id
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('useview_postnatal_care')
              field: uuid
      - name: patient_id
        tests:
          - not_null
  - name: ancview_pregnancy
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('useview_pregnancy')
              field: uuid
      - name: reported_by
        tests:
          - not_null
      - name: form
        tests:
          - not_null
          - accepted_values:
              values: [pregnancy]
  - name: form_metadata
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
      - name: reported_by
        tests:
          - not_null
      - name: chw
        tests:
          - not_null
      - name: form
        tests:
          - not_null
      - name: formname
        tests:
          - not_null
  - name: impactview_month
    columns:
      - name: month
        tests:
          - not_null
      - name: epoch
        tests:
          - not_null
  - name: impactview_month_facility
    columns:
      - name: month
        tests:
          - not_null
      - name: epoch
        tests:
          - not_null
  - name: formview_immunization_follow_up
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
  - name: formview_assessment_follow_up
    columns:
      - name: xmlforms_uuid
        tests:
          - not_null
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
  - name: formview_muac_follow_up
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
      - name: form
        tests:
          - not_null
          - accepted_values:
              values: [muac_follow_up]
  - name: formview_health_forum
    columns:
      - name: xmlforms_uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
  - name: formview_death_confirmation
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
  - name: formview_covid_referral_follow_up
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
  - name: formview_covid_evacuation_follow_up
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
  - name: followup
    columns:
      - name: form
        tests:
          - not_null
          - accepted_values:
              values:
                [
                  'family_planning',
                  'fp_follow_up_long_term',
                  'fp_follow_up_refill',
                  'fp_follow_up_prospective',
                  'fp_follow_up_short_term',
                ]
  - name: contactview_family_survey
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('couchdb')
              field: doc ->> '_id'
  - name: impactview_chw_facility
    columns:
      - name: chw_uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('contactview_chp')
              field: uuid
  - name: impactview_active
    columns:
      - name: month
        tests:
          - not_null
      - name: epoch
        tests:
          - not_null
  - name: iccmview_active
    columns:
      - name: month
        tests:
          - not_null
      - name: epoch
        tests:
          - not_null
  - name: fp_referral_cases
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('formview_fp_patient_record')
              field: uuid
      - name: form
        tests:
          - not_null
          - accepted_values:
              values:
                [
                  'family_planning',
                  'fp_follow_up_long_term',
                  'fp_follow_up_refill',
                  'fp_follow_up_prospective',
                  'fp_follow_up_short_term',
                ]
      - name: is_referral_case
        tests:
          - not_null
          - accepted_values:
              values: [true]
  - name: ancview_danger_sign
    columns:
      - name: uuid
        tests:
          - not_null
      - name: form
        tests:
          - not_null
  - name: ancview_delivery
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('useview_postnatal_care')
              field: uuid
      - name: form
        tests:
          - not_null
      - name: pregnancy_outcome
        tests:
          - not_null
          - accepted_values:
              values: [healthy, still_birth]
  - name: ancview_pregnancy_visit
    columns:
      - name: uuid
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('useview_visit')
              field: uuid
      - name: pregnancy_id
        tests:
          - not_null
      - name: form
        tests:
          - not_null
      - name: visit_with_danger_sign
        tests:
          - not_null
  - name: dashboardview_iccm
    columns:
      - name: month
        tests:
          - not_null
      - name: epoch
        tests:
          - not_null
  - name: dashboardview_iccm_active
    columns:
      - name: month
        tests:
          - not_null
      - name: epoch
        tests:
          - not_null
